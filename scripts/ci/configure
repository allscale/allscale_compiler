#!/bin/bash

set -ex

if [[ -z "${WORKSPACE+x}" ]]; then
	cd "$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
	source defaults.sh
fi

if $RUNNING_ON_CI_SERVER; then
    git config url./ssd/git-mirrors/hpx.git.insteadOf              https://github.com/STEllAR-GROUP/hpx.git
    git config url./ssd/git-mirrors/allscale_runtime.git.insteadOf https://github.com/allscale/allscale_runtime.git
    git config url./ssd/git-mirrors/allscale_api.git.insteadOf     https://github.com/allscale/allscale_api.git
    git config url./ssd/git-mirrors/insieme_base.git.insteadOf     https://github.com/insieme/insieme.git

    git submodule update --init --checkout
fi

# Create build directory if it does not exist.
mkdir -p "$BUILD_DIR"

# Assuming all required dependencies are installed, this will setup the
# symlinks corresponding to the installed version selected in the dependency
# installer.
cd "$BUILD_DIR"
PREFIX="$THIRD_PARTY_LIBS" "$WORKSPACE/scripts/dependencies/third_party_linker"
